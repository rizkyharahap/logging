[SERVICE]
    Flush     1
    Log_Level debug
    Daemon     off
    Parsers_File parsers.conf

# --- existing Go app input ---
[INPUT]
    Name  tail
    Path  /app/logs/app.log
    Tag   http-service
    Read_from_Head true

# --- nginx access log input ---
[INPUT]
    Name    forward
    Listen  0.0.0.0
    port    24224

# --- Add a console output for debugging ---
[OUTPUT]
    Name   stdout
    Match  *
    Format json_lines

# --- nginx log parser ---
[FILTER]
    Name    parser
    Match   nginx*
    Key_Name log
    Parser  nginx
    Reserve_Data On

# --- outputs ---
[OUTPUT]
    name            loki
    match           http-service
    host            loki
    port            3100
    labels          app=http-service
    drop_single_key true
    line_format     key_value

[OUTPUT]
    name            loki
    match           nginx
    host            loki
    port            3100
    labels          app=nginx
    drop_single_key true
    line_format     key_value
